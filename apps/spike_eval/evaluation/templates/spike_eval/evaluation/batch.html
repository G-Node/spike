{% extends "spike_eval/evaluation/base.html" %}

{% load i18n %}
{% load spike_eval_tags %}

{% block head_title %}{E:{{ eb.id }}}&nbsp;{{ eb.benchmark }}{% endblock %}

{% block content %}

  <div class="jumbotron subnav" xmlns="http://www.w3.org/1999/html">
    <h2>
      Evaluation Batch #{{ eb.id }}
      (<a href="{% url b_detail eb.benchmark.id %}">{{ eb.benchmark }}</a>)
      {% if eb.is_public %}- published{% endif %}
    </h2>
    <dl class="dl-horizontal">
      <dt>
        <strong>Description:</strong>
      </dt>
      <dd>
        {% if not eb.description %}
          None
        {% else %}
          {{ eb.description }}
        {% endif %}
      </dd>
      <dt>
        <strong>Algorithm:</strong>
      </dt>
      <dd>
        <a href="{% url e_algo eb.algorithm.id %}">{{ eb.algorithm }}</a>
      </dd>
      <dt>
        <strong>Author:</strong>
      </dt>
      <dd>
        <nobr>
          <i class=" icon-user"></i>
          <a href="{% url profile_detail eb.added_by.username %}">
            {{ eb.added_by.username }}
          </a>
          {% ifequal eb.added_by request.user %}(you){% endifequal %}
        </nobr>
      </dd>
      <dt>
        <strong>Date Created:</strong>
      </dt>
      <dd>
        <nobr><i class="icon-time"></i>
          {{ eb.date_created|date }}</nobr>
      </dd>
    </dl>
  </div>

  {% if user.is_authenticated %}
    {% ifequal eb.added_by user %}
      <form class="form well" method="POST">
        {% csrf_token %}
        <span class="label">Actions:</span>
        <input type="submit" class="btn btn-mini" name="switch"
         {% if e.is_public %}
           value="{% trans "Unpublish Evaluation" %}"
         {% else %}
           value="{% trans "Publish Evalulation" %}"
         {% endif %}/>
      </form>
    {% endifequal %}
  {% endif %}

  <div class="accordion" id="accordion">
    {% for e in eb.evaluation_set.all %}
      <div class="accordion-group">
        <div class="accordion-heading">

          <a class="accordion-toggle"
           href="#collapse{{ forloop.counter }}"
           data-parent="#accordion" data-toggle="collapse">
            <p class="pull-left">{{ eb }} - {{ e.trial }}</p>

            <p class="accordion-heading pull-right">
              {% if e.processed %}

                {% with e.summary_short as e_sum %}
                  True positive: {{ e_sum.TP|floatformat:2 }}%
                  False positive: {{ e_sum.FP|floatformat:2 }}%
                {% endwith %}
              {% else %}
                No evaluation results available yet.
              {% endif %}
            </p>
          </a>

          <div class="clearfix"></div>
        </div>
        <div id="collapse{{ forloop.counter }}"
         class="accordion-body collapse">
          {% comment %}
            use this to have the first trial opend initially
            {% if not forloop.counter0 %}in{% endif %}">
          {% endcomment %}
          <div class="accordion-inner">
            {% include "spike_eval/evaluation/detail.html" %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

{% endblock %}
